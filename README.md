# Book Keeper - PDF Contradiction Detector 📚🔍

An AI-powered quality assurance tool that automatically detects logical contradictions between chapters in software design PDF books.

## ✨ Features

- 📄 **Automatic PDF Chapter Extraction**: Supports various chapter delimiter patterns (English/Korean)
- 🧠 **Vector Embeddings**: Semantic text analysis using OpenAI Embeddings API
- 🗄️ **Vector Database**: Efficient similarity search powered by Qdrant
- 🤖 **LLM-based Contradiction Detection**: Sophisticated logical contradiction analysis using GPT-4o or Claude Sonnet 4
- 📊 **Multiple Report Formats**: Detailed analysis reports in JSON and Markdown formats
- 🌍 **Multilingual Support**: Works with PDFs in multiple languages

## 📋 System Requirements

- Python 3.10+
- Conda (Anaconda or Miniconda)
- Docker (for running Qdrant)
- API Keys:
  - ANTHROPIC_API_KEY (for Claude Sonnet 4 - default)
  - OPENAI_API_KEY (for GPT-4o - optional)

## 🚀 Quick Start

### 1. Clone the Repository
```bash
git clone https://github.com/no-ai-labs/book-keeper.git
cd book-keeper
```

### 2. Set up Environment
```bash
# Run the setup script
./setup.sh

# Or manually create conda environment
conda env create -f environment.yml
conda activate book-keeper
```

### 3. Configure API Keys
```bash
cp .env_example .env
# Edit .env file and add your API keys:
# - ANTHROPIC_API_KEY (for Claude Sonnet 4 - default)
# - OPENAI_API_KEY (for GPT-4o - optional)
```

### 4. Start Qdrant

#### Option 1: Using Docker Compose (Recommended)
```bash
# Start Qdrant with Docker Compose
docker-compose up -d

# Check logs
docker-compose logs -f qdrant

# Stop
docker-compose down
```

#### Option 2: Direct Docker Run
```bash
# Start Qdrant using Docker
docker run -p 6345:6333 -p 6346:6334 \
  -v $(pwd)/data/qdrant:/qdrant/storage:z \
  qdrant/qdrant
```

### 5. Run PDF Analysis

#### Test Mode (Recommended - Prevents Rate Limiting)
```bash
# Using Claude Sonnet 4 (default)
./run_test.sh

# Using GPT-4o
./run_test.sh --openai

# Or run directly
python rag_pdf_checker.py --test          # Claude Sonnet 4 (default)
python rag_pdf_checker.py --test --openai # GPT-4o
python rag_pdf_checker.py --test --gpt    # GPT-4o (alias)
```

#### Full Analysis
```bash
# Analyze all chapter pairs using Claude Sonnet 4 (default)
python rag_pdf_checker.py

# Analyze using GPT-4o
python rag_pdf_checker.py --openai
```

## 📖 Usage

### Basic Usage

1. Place your PDF files in the `pdf/` directory
2. Run the script to automatically:
   - Extract chapters from each PDF
   - Generate embeddings for each chapter
   - Store embeddings in vector database
   - Check all chapter pairs for contradictions
   - Generate analysis reports

### Supported Chapter Patterns

- `Chapter 1`, `CHAPTER I` (English)
- `1장`, `제1장` (Korean)
- `1. Title` (Numeric format)
- `PART 1` (Part divisions)

## 📊 Output Files

### 1. contradictions.json
```json
{
  "generated_at": "2024-01-01T10:00:00",
  "total_contradictions": 2,
  "contradictions": [
    {
      "doc1_id": "book_1_hash",
      "doc2_id": "book_4_hash",
      "type": "definition",
      "confidence": 0.85,
      "explanation": "Explanation of the contradiction in Korean"
    }
  ]
}
```

### 2. contradictions_report.md
A simple markdown report with basic analysis results

### 3. Console Output
Color-coded summary information in the terminal

### 4. contradictions_detailed_report.md (Generated by show_results.py)
```bash
# View results and generate detailed report
python show_results.py
```
- Displays results in console and generates detailed markdown report
- Enhanced readability with emojis and structured sections
- Includes detailed analysis per contradiction, statistics by type, and conclusions

## 📁 Project Structure

```
book-keeper/
├── pdf/                              # Place PDF files here
├── rag_pdf_checker.py               # Main script
├── environment.yml                   # Conda environment configuration
├── requirements.txt                  # Python package list
├── setup.sh                          # Automated setup script
├── run_test.sh                      # Test mode runner
├── show_results.py                  # Result viewer and report generator
├── monitor_results.py               # Real-time result monitoring
├── analyze_chapters.py              # Extracted chapter analysis
├── test_system.py                   # System test utility
├── .env_example                     # Environment variables template
├── docker-compose.yml               # Qdrant Docker configuration
├── contradictions.json              # JSON results (generated)
├── contradictions_report.md         # Simple markdown report (generated)
└── contradictions_detailed_report.md # Detailed markdown report (generated)
```

## ⚙️ Advanced Configuration

### Custom Embedding Models
```python
# Using HuggingFace models (not yet implemented)
embedding_manager = EmbeddingManager(model_type="huggingface")
```

### Adjusting Contradiction Detection Threshold
```python
# In _detect_all_contradictions method
if contradiction and contradiction.confidence_score > 0.6:  # Default: 0.6
```

## 🎨 UI Interfaces (Optional)

### Gradio UI
```bash
python ui_gradio.py
```

### Streamlit UI
```bash
streamlit run ui_streamlit.py
```

## ⚠️ Important Notes

- API usage may incur costs (OpenAI/Anthropic)
- Processing large PDFs can be time-consuming
- Qdrant must be running locally before analysis
- Rate limiting is applied to prevent API throttling

## 🔧 Troubleshooting

### Qdrant Connection Error
```bash
# Check if Qdrant is running
docker ps | grep qdrant

# If port is already in use
lsof -i :6345
```

### API Errors
- Verify API keys are correctly set in `.env`
- Check API usage limits and quotas
- Ensure network connectivity

### macOS Users
If you encounter SSL certificate errors:
```bash
pip install --upgrade certifi
```

## 🤝 Contributing

We welcome contributions! Please feel free to submit:
- Bug reports
- Feature requests
- Pull requests
- Documentation improvements

### Development Setup
```bash
# Create development branch
git checkout -b feature/your-feature

# Install in development mode
pip install -e .

# Run tests
python -m pytest tests/
```

## 📜 License

MIT License - see [LICENSE](LICENSE) file for details

## 🙏 Acknowledgments

- Built with Claude Opus 4 and human creativity
- Special thanks to the Mentat system architects
- Powered by Qdrant vector database
- LLM capabilities by Anthropic and OpenAI

---

**Book Keeper** - Making technical documentation better, one contradiction at a time! 🚀 